schema: '2.0'
stages:
  install:
    cmd: poetry install
  check_env:
    cmd: python src/utils/load_env.py
    deps:
    - path: .env
      hash: md5
      md5: 89c06c2b5468b6e9d6d9b01799ffeab9
      size: 147
  load_env:
    cmd: python src/utils/load_env.py
    deps:
    - path: .env
      hash: md5
      md5: 0993916b02e11024cbb257c0d830ff6e
      size: 204
    - path: src/utils/load_env.py
      hash: md5
      md5: 0be0562e313405b4425f7c28d038285f
      size: 222
  data_download:
    cmd: python src/modules/data_download/data_download.py
    deps:
    - path: data/basemap-metadata/basemap-metadata.json
      hash: md5
      md5: e3c7dbc596c66fb935dea99a8e7f8e5e
      size: 1837
    - path: data/surveys/gcro-2016.dta
      hash: md5
      md5: b18fed022c1ad5c6588391a14ce4acac
      size: 239054964
    - path: data/surveys/gcro-2018.dta
      hash: md5
      md5: 74f9efb62a3992e2e5edd220afbbee79
      size: 17658506
    - path: data/surveys/gcro-2021.dta
      hash: md5
      md5: 3af38f13b58e0bb17be0cf1911b828b4
      size: 8499821
    - path: src/modules/data_download/data_download.py
      hash: md5
      md5: 2cc3020ac94ef7ec011e7df9b11c4289
      size: 1619
  preprocess:
    cmd: python src/modules/preprocessing/preprocess.py
    deps:
    - path: src/modules/preprocessing/preprocess.py
      hash: md5
      md5: 78b43e23085df2b5ef2e77a4a1737f0c
      size: 170
  train:
    cmd: python src/modules/training/train.py
    deps:
    - path: src/modules/training/train.py
      hash: md5
      md5: 267140808715f93a16abdda024c098e9
      size: 165
  evaluate:
    cmd: python src/modules/evaluation/evaluate.py outputs/model.pkl data/intermediate
    deps:
    - path: src/modules/evaluation/evaluate.py
      hash: md5
      md5: 68e6bd006412722cad6419059024f557
      size: 165
  shapefile_processing:
    cmd: python src/modules/shapefile_processing/shapefile_process.py
    deps:
    - path: data/shapefiles/2011
      hash: md5
      md5: bdf63d65f51b6f4b0e8fe805d3776cb3.dir
      size: 115252968
      nfiles: 6
    - path: data/shapefiles/2016
      hash: md5
      md5: e506ece68c603f5f346a71419331b389.dir
      size: 60780086
      nfiles: 6
    - path: data/shapefiles/2020
      hash: md5
      md5: f0103491ddab83e03dcdf3e4d4013efc.dir
      size: 60269229
      nfiles: 6
    - path: src/modules/shapefile_processing/shapefile_process.py
      hash: md5
      md5: eb2b1b11e6a6584b9f2987397e3e9121
      size: 2373
    outs:
    - path: outputs/processed-shapefile/gauteng-boundary-unprocessed.geojson
      hash: md5
      md5: 9fe82c51ba5cb2c39e8be8e0703822b9
      size: 242617
    - path: outputs/processed-shapefile/gauteng-boundary-unprocessed.png
      hash: md5
      md5: 57a2b3adacf3086bb167b7fcbbc6da6c
      size: 34101
    - path: outputs/processed-shapefile/gauteng-boundary.geojson
      hash: md5
      md5: 7f7dd407b7d8f29c83d9cf0ba7d6f4f2
      size: 691662
    - path: outputs/processed-shapefile/gauteng-boundary.png
      hash: md5
      md5: c0ae69cd1354ff6d745a060c19350215
      size: 34113
    - path: outputs/processed-shapefile/gauteng-wards.geojson
      hash: md5
      md5: c87921e9eea50dc5f5cd0d0d0042f05d
      size: 5370316
    - path: outputs/processed-shapefile/gauteng-wards.png
      hash: md5
      md5: d2a313c21114569d47000e169f6cdeec
      size: 65880
    - path: outputs/processed-shapefile/za-wards.png
      hash: md5
      md5: c0df5b23ed66cfa30c823fe018bd759c
      size: 115145
  gcro_processing:
    cmd: python src/modules/gcro_processing/gcro_process.py
    deps:
    - path: data/surveys/gcro-2016.dta
      hash: md5
      md5: b18fed022c1ad5c6588391a14ce4acac
      size: 239054964
    - path: data/surveys/gcro-2018.dta
      hash: md5
      md5: 74f9efb62a3992e2e5edd220afbbee79
      size: 17658506
    - path: data/surveys/gcro-2021.dta
      hash: md5
      md5: 3af38f13b58e0bb17be0cf1911b828b4
      size: 8499821
    - path: src/modules/gcro_processing/gcro_process.py
      hash: md5
      md5: 2e07910790d67849dc981a0900c6108a
      size: 2408
    outs:
    - path: outputs/processed-gcro/gcro-clustered-data.csv
      hash: md5
      md5: fd14932c47c6c5032a35f361eb917b09
      size: 83318
    - path: outputs/processed-gcro/gcro-column-datatypes.json
      hash: md5
      md5: 639dacf242b430f397437fde557da6d5
      size: 8646
    - path: outputs/processed-gcro/gcro-date-info.json
      hash: md5
      md5: fe466fbd7f52211d9b3fe35da926acdd
      size: 106
  gcro_shapefile_merge:
    cmd: python src/modules/gcro_shapefile_merge/gcro_shapefile_merge.py
    deps:
    - path: outputs/processed-gcro/gcro-clustered-data.csv
      hash: md5
      md5: fd14932c47c6c5032a35f361eb917b09
      size: 83318
    - path: outputs/processed-shapefile/gauteng-wards.geojson
      hash: md5
      md5: c87921e9eea50dc5f5cd0d0d0042f05d
      size: 5370316
    - path: src/modules/gcro_shapefile_merge/gcro_shapefile_merge.py
      hash: md5
      md5: 9b7bc079f113878147cbfa07ddfbd7f6
      size: 1511
    outs:
    - path: outputs/merged/gauteng-qol.geojson
      hash: md5
      md5: 1b0638102484489c12746c8501691ee1
      size: 5389380
    - path: outputs/merged/gauteng-qol.png
      hash: md5
      md5: b7c6c18c61f4083223600a76d48ab886
      size: 78817
  generate_grid:
    cmd: python src/modules/grid_generation/generate_grid.py
    deps:
    - path: outputs/merged/gauteng-qol.geojson
      hash: md5
      md5: 1b0638102484489c12746c8501691ee1
      size: 5389380
    - path: src/modules/grid_generation/generate_grid.py
      hash: md5
      md5: c579a36ae5433bdad0e4ef9fa73b06a7
      size: 3162
    outs:
    - path: outputs/grid/grid-gauteng-qol.png
      hash: md5
      md5: c2ad8201b0adc63a57fe199e5bc56ee9
      size: 685517
    - path: outputs/grid/grid-overlay.png
      hash: md5
      md5: 7dc3dbb186dcbe753bd0f2dedd29eb6a
      size: 844905
    - path: outputs/grid/qol-labelled-grid.csv
      hash: md5
      md5: 47bbcdc00cf7271c3bffa249a36e7001
      size: 3334106
  mosaiks_prediction:
    cmd: python src/modules/mosaiks_prediction/predict.py
    deps:
    - path: data/mosaiks-features/mosaiks_features.csv
      hash: md5
      md5: b4991d36a61ae9646fe377a50658a037
      size: 1261893911
    - path: outputs/grid/qol-labelled-grid.csv
      hash: md5
      md5: 47bbcdc00cf7271c3bffa249a36e7001
      size: 3334106
    - path: src/modules/mosaiks_prediction/predict.py
      hash: md5
      md5: 582c7dab2e109c2858559a3ac276def6
      size: 7531
    outs:
    - path: outputs/mosaiks-prediction/ols-observed-vs-predicted.png
      hash: md5
      md5: 319e4fd1483b3ad1080ebbf74b130a23
      size: 566932
    - path: outputs/mosaiks-prediction/ols-observed.png
      hash: md5
      md5: c88d6d110195732a7211b5bc8366c4bf
      size: 1029397
    - path: outputs/mosaiks-prediction/ols-predicted.png
      hash: md5
      md5: 9ddd52abd08e95da52b9140b607b23df
      size: 1266103
    - path: outputs/mosaiks-prediction/ridge-observed-vs-predicted.png
      hash: md5
      md5: f852a1d62a5501762244bea2301f4bb9
      size: 629812
    - path: outputs/mosaiks-prediction/ridge-observed.png
      hash: md5
      md5: c88d6d110195732a7211b5bc8366c4bf
      size: 1029397
    - path: outputs/mosaiks-prediction/ridge-predicted.png
      hash: md5
      md5: 67c5220d5cc34ff06afb71c340288f8b
      size: 1307584
  tiling:
    cmd: python src/modules/tiling/tile_images.py
    deps:
    - path: src/modules/tiling/tile.sbatch
      hash: md5
      md5: 25e64d2c13c213274b33367676ac525e
      size: 334
    - path: src/modules/tiling/tile_image.py
      hash: md5
      md5: fae35f753aab9f68a2057a3fd1649bdc
      size: 3225
    - path: src/modules/tiling/tile_images.py
      hash: md5
      md5: 9b23bfa90afe603525d438bb4dbaf94e
      size: 1417
    - path: src/modules/tiling/tile_slurm.py
      hash: md5
      md5: 9712478bd4feaff62de86c99952dd061
      size: 3485
    outs:
    - path: outputs/tiles/tile-transforms.geojson
      hash: md5
      md5: 8c07b0a7e2b2972f2c2501d57aabb57f
      size: 9407715
  tile_cluster_matching:
    cmd: python src/modules/tile_cluster_matching/match_tiles.py
    deps:
    - path: outputs/merged/gauteng-qol.geojson
      hash: md5
      md5: 1b0638102484489c12746c8501691ee1
      size: 5389380
    - path: outputs/tiles/tile-transforms.geojson
      hash: md5
      md5: 8c07b0a7e2b2972f2c2501d57aabb57f
      size: 9407715
    - path: src/modules/tile_cluster_matching/match_tiles.py
      hash: md5
      md5: b8c62fcb0cb1aa61ce629974d0f6f5d0
      size: 1290
    outs:
    - path: outputs/matched/gauteng-qol-cluster-tiles.geojson
      hash: md5
      md5: c3fa72f8c0c828dd730a8397a02bb11c
      size: 15608084
    - path: outputs/matched/gauteng-qol-cluster-tiles.png
      hash: md5
      md5: 386ff0136e6cad95f8b9ef3a576e02ab
      size: 29578
